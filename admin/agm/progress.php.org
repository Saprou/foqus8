<?php
header('Content-Type: text/event-stream');
header('Cache-Control: no-cache');

function send_message($event, $message, $progress = 1) {
    $d = array('message' => $message, 'progress' => $progress);

    echo "event: $event" . PHP_EOL;
    echo "data: " . json_encode($d) . PHP_EOL;
    echo PHP_EOL;

    ob_flush();
    flush();
}





// get contents of a file into a string

$filename = "progress.txt";

Start: 
//sleep(1);
$handle = fopen($filename, "r");
$contents = fread($handle, 100);
fclose($handle);

if (substr($contents, 0, 5) == 'close' ){ send_message('close', 'Process complete'); } else { send_message('progress', "$contents" ); goto Start ;}
//send_message('close', 'Process complete');
//if ( connection_aborted() ) break;
//break;
//unlink("progress.txt");
sleep(10);
$filename = "progress.txt";
$f=fopen('progress.txt','w');
fwrite($f,'Wait');
fclose($f);
?>



